# Примитивная база данных

## Содержание

1. [Обзор проекта](#обзор-проекта)
2. [Требования](#требования)
3. [Установка](#установка)
4. [Использование](#использование)
5. [Архитектура](#архитектура)
6. [Команды](#команды)
7. [Поддерживаемые типы данных](#поддерживаемые-типы-данных)
8. [Структура проекта](#структура-проекта)
9. [Разработка](#разработка)
10. [Обработка ошибок](#обработка-ошибок)

## Обзор проекта

Примитивная база данных - это учебный проект, реализующий базовую систему управления таблицами. Проект разработан для демонстрации принципов работы с базами данных, включая создание таблиц, управление метаданными и персистентное хранение.

Основные возможности:
- Создание таблиц с определением структуры
- Автоматическое управление первичными ключами
- Просмотр списка существующих таблиц
- Удаление таблиц
- Сохранение метаданных в файловой системе

## Требования

- Python 3.12 или выше
- Poetry для управления зависимостями
- Git для контроля версий

## Установка

### Установка из исходного кода

```bash
# Клонирование репозитория
git clone <repository-url>
cd project-2-naydanov-leonid

# Установка зависимостей через Poetry
make install
```

### Установка как пакета

```bash
# Сборка пакета
make build

# Установка пакета
make package-install
```

## Использование

### Запуск приложения

```bash
# Через Poetry
make run

# Через Python модуль
poetry run python -m src.primitive_db.main

# После установки пакета
database
```

### Пример сессии работы

```
Первая попытка запустить проект!
***

***База данных***

Функции работы с таблицами:
<command> create_table <имя_таблицы> <столбец1:тип> <столбец2:тип> .. - создать таблицу
<command> list_tables - показать список всех таблиц
<command> drop_table <имя_таблицы> - удалить таблицу

Общие команды:
<command> exit - выход из программы
<command> help - справочная информация

Введите команду: create_table users name:str age:int email:str
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, email:str

Введите команду: create_table products title:str price:int in_stock:bool
Таблица "products" успешно создана со столбцами: ID:int, title:str, price:int, in_stock:bool

Введите команду: list_tables
1. users (ID:int, name:str, age:int, email:str)
2. products (ID:int, title:str, price:int, in_stock:bool)

Введите команду: drop_table products
Таблица "products" успешно удалена.

Введите команду: exit
Выход из программы...
```

## Архитектура

Проект реализован с использованием модульной архитектуры, состоящей из следующих компонентов:

### Основные модули:

1. **engine.py** - основной движок приложения
   - Обработка пользовательского ввода
   - Парсинг команд
   - Управление жизненным циклом приложения

2. **core.py** - бизнес-логика
   - Создание таблиц
   - Удаление таблиц
   - Валидация данных
   - Управление метаданными

3. **utils.py** - вспомогательные функции
   - Работа с файловой системой
   - Сериализация/десериализация JSON
   - Утилитарные функции

4. **main.py** - точка входа
   - Инициализация приложения
   - Запуск основного цикла

## Команды

### Основные команды

| Команда | Описание | Формат | Пример |
|---------|----------|--------|---------|
| `create_table` | Создание новой таблицы | `create_table <имя> <столбец1:тип> ...` | `create_table users name:str age:int` |
| `list_tables` | Просмотр списка таблиц | `list_tables` | `list_tables` |
| `drop_table` | Удаление таблицы | `drop_table <имя>` | `drop_table users` |
| `help` | Справка по командам | `help` | `help` |
| `exit` | Выход из программы | `exit` | `exit` |

### Формат команды create_table

```
create_table <table_name> <column1:type> <column2:type> ...
```

- `table_name`: имя таблицы (только латинские буквы, цифры и подчеркивание)
- `column:type`: определение столбца в формате "имя:тип"

## Поддерживаемые типы данных

Проект поддерживает три базовых типа данных:

1. **int** - целочисленные значения
   - Пример: `age:int`
   - Использование: числовые данные без дробной части

2. **str** - строковые значения
   - Пример: `name:str`
   - Использование: текстовые данные произвольной длины

3. **bool** - логические значения
   - Пример: `is_active:bool`
   - Использование: логические флаги (true/false)

**Важно**: Каждая таблица автоматически получает столбец `ID:int` в качестве первичного ключа.

## Структура проекта

```
project-2-naydanov-leonid/
├── pyproject.toml              # Конфигурация Poetry
├── README.md                   # Документация
├── Makefile                    # Автоматизация задач
├── db_meta.json               # Файл метаданных (создается автоматически)
│
├── src/                        # Исходный код
│   ├── __init__.py
│   └── primitive_db/          # Основной пакет
│       ├── __init__.py
│       ├── main.py            # Точка входа
│       ├── engine.py          # Движок приложения
│       ├── core.py            # Бизнес-логика
│       └── utils.py           # Вспомогательные функции
│
├── dist/                       # Собранные пакеты (после poetry build)
└── .gitignore                  # Игнорируемые файлы Git
```

### Файл метаданных

Приложение создает файл `db_meta.json` для хранения информации о таблицах. Формат файла:

```json
{
  "users": {
    "columns": ["ID:int", "name:str", "age:int", "email:str"]
  },
  "products": {
    "columns": ["ID:int", "title:str", "price:int", "in_stock:bool"]
  }
}
```

## Разработка

### Сборка проекта

```bash
# Проверка кода
make lint

# Форматирование кода
make format

# Сборка пакета
make build

# Установка локально
make package-install
```

### Автоматизация с Makefile

Проект включает Makefile с наиболее часто используемыми командами:

```bash
make install          # Установка зависимостей
make run              # Запуск приложения
make lint             # Проверка качества кода
make build            # Сборка пакета
make package-install  # Установка нужных пакетов
make publish          # Пробная публикация без загрузки в PyPi
make help             # Справка по командам
```

## Обработка ошибок

Приложение включает обработку следующих ошибок:

1. **Несуществующие команды** - вывод сообщения об ошибке
2. **Некорректные аргументы** - валидация формата ввода
3. **Неподдерживаемые типы данных** - проверка допустимых типов
4. **Дублирование таблиц** - предотвращение создания существующих таблиц
5. **Удаление несуществующих таблиц** - проверка перед удалением

Примеры сообщений об ошибках:
- `Функции 'unknown_command' нет. Попробуйте снова.`
- `Некорректное значение: "name". Используйте формат "имя:тип".`
- `Таблица "users" уже существует.`
- `Таблица "products" не существует.`
